/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2019-03-25 12:59:31 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.WEB_002dINF.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class product_002dadd_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {


    private String htmlspecialchars(String str) {
        str = str.replaceAll("&", "&amp;");
        str = str.replaceAll("<", "&lt;");
        str = str.replaceAll(">", "&gt;");
        str = str.replaceAll("\"", "&quot;");
        return str;
    }

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write('\r');
      out.write('\n');

    request.setCharacterEncoding("UTF-8");
    String htmlData = request.getParameter("detail") != null ? request.getParameter("detail") : "";

      out.write("\r\n");
      out.write("<!--_meta 作为公共模版分离出去-->\r\n");
      out.write("<!DOCTYPE HTML>\r\n");
      out.write("<html>\r\n");
      out.write("<head>\r\n");
      out.write("    <meta charset=\"utf-8\">\r\n");
      out.write("    <meta name=\"renderer\" content=\"webkit|ie-comp|ie-stand\">\r\n");
      out.write("    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\r\n");
      out.write("    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no\" />\r\n");
      out.write("    <meta http-equiv=\"Cache-Control\" content=\"no-siteapp\" />\r\n");
      out.write("    <link rel=\"Bookmark\" href=\"/icon/favicon.ico\" >\r\n");
      out.write("    <link rel=\"Shortcut Icon\" href=\"/icon/favicon.ico\" />\r\n");
      out.write("    <!--[if lt IE 9]>\r\n");
      out.write("    <script type=\"text/javascript\" src=\"lib/html5shiv.js\"></script>\r\n");
      out.write("    <script type=\"text/javascript\" src=\"lib/respond.min.js\"></script>\r\n");
      out.write("\r\n");
      out.write("    <![endif]-->\r\n");
      out.write("    <link rel=\"stylesheet\" type=\"text/css\" href=\"static/h-ui/css/H-ui.min.css\" />\r\n");
      out.write("    <link rel=\"stylesheet\" type=\"text/css\" href=\"static/h-ui.admin/css/H-ui.admin.css\" />\r\n");
      out.write("    <link rel=\"stylesheet\" type=\"text/css\" href=\"lib/Hui-iconfont/1.0.8/iconfont.css\" />\r\n");
      out.write("\r\n");
      out.write("    <link rel=\"stylesheet\" type=\"text/css\" href=\"static/h-ui.admin/skin/default/skin.css\" id=\"skin\" />\r\n");
      out.write("    <link rel=\"stylesheet\" type=\"text/css\" href=\"static/h-ui.admin/css/style.css\" />\r\n");
      out.write("    <!--[if IE 6]>\r\n");
      out.write("    <script type=\"text/javascript\" src=\"lib/DD_belatedPNG_0.0.8a-min.js\" ></script>\r\n");
      out.write("    <script>DD_belatedPNG.fix('*');</script>\r\n");
      out.write("    <![endif]-->\r\n");
      out.write("    <!--/meta 作为公共模版分离出去-->\r\n");
      out.write("\r\n");
      out.write("    <link href=\"lib/webuploader/0.1.5/webuploader.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("</head>\r\n");
      out.write("<body>\r\n");
      out.write("<div class=\"page-container\">\r\n");
      out.write("    ");
      out.print(htmlData);
      out.write("\r\n");
      out.write("    <form name=\"product-add\" action=\"\" method=\"post\" class=\"form form-horizontal\" id=\"product-add\">\r\n");
      out.write("        <div class=\"row cl\">\r\n");
      out.write("            <label class=\"form-label col-xs-4 col-sm-2\"><span class=\"c-red\">*</span>产品标题：</label>\r\n");
      out.write("            <div class=\"formControls col-xs-8 col-sm-9\">\r\n");
      out.write("                <input type=\"text\" class=\"input-text\" value=\"\" placeholder=\"\" name=\"title\">\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"row cl\">\r\n");
      out.write("            <label class=\"form-label col-xs-4 col-sm-2\"><span class=\"c-red\">*</span>简介描述：</label>\r\n");
      out.write("            <div class=\"formControls col-xs-8 col-sm-9\">\r\n");
      out.write("                <input type=\"text\" class=\"input-text\" value=\"\" placeholder=\"\" name=\"sellPoint\">\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"row cl\">\r\n");
      out.write("            <label class=\"form-label col-xs-4 col-sm-2\"><span class=\"c-red\">*</span>商品分类：</label>\r\n");
      out.write("            <div class=\"formControls col-xs-8 col-sm-9\">\r\n");
      out.write("                <input type=\"text\" hidden class=\"input-text\" id=\"cid\" name=\"cid\" >\r\n");
      out.write("\t\t\t\t<input type=\"text\" onclick=\"chooseCategory()\" readonly class=\"input-text\" value=\"\" placeholder=\"请点击选择按钮选择商品分类\" id=\"cname\" name=\"cname\" style=\"width:50%\">\r\n");
      out.write("                <input type=\"button\" onclick=\"chooseCategory()\" class=\"btn btn-secondary radius\" value=\"选择类别\">\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"row cl\">\r\n");
      out.write("            <label class=\"form-label col-xs-4 col-sm-2\"><span class=\"c-red\">*</span>产品展示价格：</label>\r\n");
      out.write("            <div class=\"formControls col-xs-8 col-sm-9\">\r\n");
      out.write("                <input type=\"text\" name=\"price\" placeholder=\"请输入正确金额\" value=\"\" class=\"input-text\" style=\"width:50%\">\r\n");
      out.write("                元</div>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"row cl\">\r\n");
      out.write("            <label class=\"form-label col-xs-4 col-sm-2\"><span class=\"c-red\">*</span>库存数量：</label>\r\n");
      out.write("            <div class=\"formControls col-xs-8 col-sm-9\">\r\n");
      out.write("                <input type=\"text\" name=\"num\" id=\"num\" placeholder=\"0~99999\" value=\"\" class=\"input-text\" style=\"width:50%\">\r\n");
      out.write("                件</div>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"row cl\">\r\n");
      out.write("            <label class=\"form-label col-xs-4 col-sm-2\"><span class=\"c-red\">*</span>购买限制数量：</label>\r\n");
      out.write("            <div class=\"formControls col-xs-8 col-sm-9\">\r\n");
      out.write("                <input type=\"text\" name=\"limitNum\" id=\"limitNum\" placeholder=\"0~9999\" value=\"\" class=\"input-text\" style=\"width:50%\">\r\n");
      out.write("                件</div>\r\n");
      out.write("        </div>\r\n");
      out.write("        <input type=\"text\" name=\"image\" id=\"image\" hidden/>\r\n");
      out.write("        <div class=\"row cl\">\r\n");
      out.write("            <label class=\"form-label col-xs-4 col-sm-2\"><span class=\"c-red\">*</span>展示缩略图片上传：</label>\r\n");
      out.write("            <div class=\"formControls col-xs-8 col-sm-9\">\r\n");
      out.write("                <div class=\"uploader-list-container\">\r\n");
      out.write("                    <div class=\"queueList\">\r\n");
      out.write("                        <div id=\"dndArea\" class=\"placeholder\">\r\n");
      out.write("                            <div name=\"filePicker\" id=\"filePicker-2\"></div>\r\n");
      out.write("                            <p>或将照片拖到这里，最多可选5张</p>\r\n");
      out.write("                        </div>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    <div class=\"statusBar\" style=\"display:none;\">\r\n");
      out.write("                        <div class=\"progress\"> <span class=\"text\">0%</span> <span class=\"percentage\"></span> </div>\r\n");
      out.write("                        <div class=\"info\"></div>\r\n");
      out.write("                        <div class=\"btns\">\r\n");
      out.write("                            <div id=\"filePicker2\"></div>\r\n");
      out.write("                            <div class=\"uploadBtn\">开始上传</div>\r\n");
      out.write("                        </div>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"row cl\">\r\n");
      out.write("            <label class=\"form-label col-xs-4 col-sm-2\">商品详情：</label>\r\n");
      out.write("            <div class=\"formControls col-xs-8 col-sm-9\">\r\n");
      out.write("                <textarea name=\"detail\" style=\"width:100%;visibility:hidden;\">");
      out.print(htmlspecialchars(htmlData));
      out.write("</textarea>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"row cl\">\r\n");
      out.write("            <div class=\"col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2\">\r\n");
      out.write("                <button id=\"saveButton\" class=\"btn btn-primary radius\" type=\"submit\"><i class=\"Hui-iconfont\">&#xe632;</i> 保存并发布</button>\r\n");
      out.write("                <button onClick=\"layer_close();\" class=\"btn btn-default radius\" type=\"button\">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("    </form>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("<!--_footer 作为公共模版分离出去-->\r\n");
      out.write("<script type=\"text/javascript\" src=\"lib/jquery/1.9.1/jquery.min.js\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"lib/layer/2.4/layer.js\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"static/h-ui/js/H-ui.min.js\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"static/h-ui.admin/js/H-ui.admin.js\"></script> <!--/_footer 作为公共模版分离出去-->\r\n");
      out.write("\r\n");
      out.write("<!--请在下方写此页面业务相关的脚本-->\r\n");
      out.write("<script type=\"text/javascript\" src=\"lib/My97DatePicker/4.8/WdatePicker.js\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"lib/jquery.validation/1.14.0/jquery.validate.js\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"lib/jquery.validation/1.14.0/validate-methods.js\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"lib/jquery.validation/1.14.0/messages_zh.js\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"lib/webuploader/0.1.5/webuploader.min.js\"></script>\r\n");
      out.write("<link rel=\"stylesheet\" href=\"lib/kindeditor/themes/default/default.css\" />\r\n");
      out.write("<link rel=\"stylesheet\" href=\"lib/kindeditor/plugins/code/prettify.css\" />\r\n");
      out.write("<script charset=\"utf-8\" src=\"lib/kindeditor/kindeditor.js\"></script>\r\n");
      out.write("<script charset=\"utf-8\" src=\"lib/kindeditor/lang/zh-CN.js\"></script>\r\n");
      out.write("<script charset=\"utf-8\" src=\"lib/kindeditor/plugins/code/prettify.js\"></script>\r\n");
      out.write("<script type=\"text/javascript\">\r\n");
      out.write("    var editor;\r\n");
      out.write("\r\n");
      out.write("    jQuery.validator.addMethod(\"decimalsValue\",function(value, element) {\r\n");
      out.write("        var decimalsValue =/^(?!0+(?:\\.0+)?$)(?:[1-9]\\d*|0)(?:\\.\\d{1,2})?$/ ;\r\n");
      out.write("        return this.optional(element) || (decimalsValue.test(value));\r\n");
      out.write("    }, \"金额必须大于0并且只能精确到分\");\r\n");
      out.write("\r\n");
      out.write("    function giveCid(cid){\r\n");
      out.write("        $(\"#cid\").val(cid);\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    function giveCName(cname){\r\n");
      out.write("        $(\"#cname\").val(cname);\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    function chooseCategory(){\r\n");
      out.write("        layer_show(\"选择商品分类\",\"choose-category\",300,510);\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    //保存发布\r\n");
      out.write("    $(\"#product-add\").validate({\r\n");
      out.write("        rules:{\r\n");
      out.write("            title:{\r\n");
      out.write("                required:true,\r\n");
      out.write("            },\r\n");
      out.write("            sellPoint:{\r\n");
      out.write("                required:true,\r\n");
      out.write("            },\r\n");
      out.write("            cname:{\r\n");
      out.write("                required:true,\r\n");
      out.write("            },\r\n");
      out.write("            price:{\r\n");
      out.write("                decimalsValue:true,\r\n");
      out.write("                required:true,\r\n");
      out.write("                maxlength:10,\r\n");
      out.write("            },\r\n");
      out.write("            num:{\r\n");
      out.write("                digits:true,\r\n");
      out.write("                required:true,\r\n");
      out.write("                maxlength:5,\r\n");
      out.write("            },\r\n");
      out.write("            limitNum:{\r\n");
      out.write("                digits:true,\r\n");
      out.write("                required:true,\r\n");
      out.write("                maxlength:4,\r\n");
      out.write("            },\r\n");
      out.write("        },\r\n");
      out.write("        onkeyup:false,\r\n");
      out.write("        focusCleanup:false,\r\n");
      out.write("        success:\"valid\",\r\n");
      out.write("        submitHandler:function(form){\r\n");
      out.write("            if(images==null){\r\n");
      out.write("                layer.alert('请上传商品展示缩略图! ', {title: '错误信息',icon: 0});\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("            var index = layer.load(3);\r\n");
      out.write("            editor.sync();\r\n");
      out.write("            $(form).ajaxSubmit({\r\n");
      out.write("                url: \"/item/add\",\r\n");
      out.write("                type: \"POST\",\r\n");
      out.write("                success: function(data) {\r\n");
      out.write("                    layer.close(index);\r\n");
      out.write("                    if(data.success==true){\r\n");
      out.write("                        if(parent.location.pathname!='/'){\r\n");
      out.write("                            parent.productCount();\r\n");
      out.write("                            parent.refresh();\r\n");
      out.write("                            parent.msgSuccess(\"添加成功!\");\r\n");
      out.write("                            var index = parent.layer.getFrameIndex(window.name);\r\n");
      out.write("                            parent.layer.close(index);\r\n");
      out.write("                        }else{\r\n");
      out.write("                            layer.confirm('添加成功!', {\r\n");
      out.write("                                btn: ['确认'],icon: 1\r\n");
      out.write("                            }, function(){\r\n");
      out.write("                                var index = parent.layer.getFrameIndex(window.name);\r\n");
      out.write("                                parent.layer.close(index);\r\n");
      out.write("                            });\r\n");
      out.write("                        }\r\n");
      out.write("                    }else{\r\n");
      out.write("                        layer.alert(data.message, {title: '错误信息',icon: 2});\r\n");
      out.write("                    }\r\n");
      out.write("                },\r\n");
      out.write("                error:function(XMLHttpRequest) {\r\n");
      out.write("                    layer.close(index);\r\n");
      out.write("                    layer.alert('数据处理失败! 错误码:'+XMLHttpRequest.status,{title: '错误信息',icon: 2});\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("        }\r\n");
      out.write("    });\r\n");
      out.write("\r\n");
      out.write("    KindEditor.ready(function(K) {\r\n");
      out.write("        editor = K.create('textarea[name=\"detail\"]', {\r\n");
      out.write("            cssPath : 'lib/kindeditor/plugins/code/prettify.css',\r\n");
      out.write("            uploadJson : '/kindeditor/imageUpload',\r\n");
      out.write("            fileManagerJson : '/kindeditor/imageUpload',\r\n");
      out.write("            allowFileManager : false,\r\n");
      out.write("            height : '400px',\r\n");
      out.write("            afterCreate : function() {\r\n");
      out.write("                var self = this;\r\n");
      out.write("                K.ctrl(document, 13, function() {\r\n");
      out.write("                    self.sync();\r\n");
      out.write("                    document.forms['product-add'].submit();\r\n");
      out.write("                });\r\n");
      out.write("                K.ctrl(self.edit.doc, 13, function() {\r\n");
      out.write("                    self.sync();\r\n");
      out.write("                    document.forms['product-add'].submit();\r\n");
      out.write("                });\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("        prettyPrint();\r\n");
      out.write("    });\r\n");
      out.write("\r\n");
      out.write("    var images=null;\r\n");
      out.write("\r\n");
      out.write("    (function ($) {\r\n");
      out.write("        $('.skin-minimal input').iCheck({\r\n");
      out.write("            checkboxClass: 'icheckbox-blue',\r\n");
      out.write("            radioClass: 'iradio-blue',\r\n");
      out.write("            increaseArea: '20%'\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // 当domReady的时候开始初始化\r\n");
      out.write("        $(function () {\r\n");
      out.write("            var $wrap = $('.uploader-list-container'),\r\n");
      out.write("\r\n");
      out.write("                // 图片容器\r\n");
      out.write("                $queue = $('<ul class=\"filelist\"></ul>')\r\n");
      out.write("                    .appendTo($wrap.find('.queueList')),\r\n");
      out.write("\r\n");
      out.write("                // 状态栏，包括进度和控制按钮\r\n");
      out.write("                $statusBar = $wrap.find('.statusBar'),\r\n");
      out.write("\r\n");
      out.write("                // 文件总体选择信息。\r\n");
      out.write("                $info = $statusBar.find('.info'),\r\n");
      out.write("\r\n");
      out.write("                // 上传按钮\r\n");
      out.write("                $upload = $wrap.find('.uploadBtn'),\r\n");
      out.write("\r\n");
      out.write("                // 没选择文件之前的内容。\r\n");
      out.write("                $placeHolder = $wrap.find('.placeholder'),\r\n");
      out.write("\r\n");
      out.write("                $progress = $statusBar.find('.progress').hide(),\r\n");
      out.write("\r\n");
      out.write("                // 添加的文件数量\r\n");
      out.write("                fileCount = 0,\r\n");
      out.write("\r\n");
      out.write("                // 添加的文件总大小\r\n");
      out.write("                fileSize = 0,\r\n");
      out.write("\r\n");
      out.write("                // 优化retina, 在retina下这个值是2\r\n");
      out.write("                ratio = window.devicePixelRatio || 1,\r\n");
      out.write("\r\n");
      out.write("                // 缩略图大小\r\n");
      out.write("                thumbnailWidth = 110 * ratio,\r\n");
      out.write("                thumbnailHeight = 110 * ratio,\r\n");
      out.write("\r\n");
      out.write("                // 可能有pedding, ready, uploading, confirm, done.\r\n");
      out.write("                state = 'pedding',\r\n");
      out.write("\r\n");
      out.write("                // 所有文件的进度信息，key为file id\r\n");
      out.write("                percentages = {},\r\n");
      out.write("                // 判断浏览器是否支持图片的base64\r\n");
      out.write("                isSupportBase64 = (function () {\r\n");
      out.write("                    var data = new Image();\r\n");
      out.write("                    var support = true;\r\n");
      out.write("                    data.onload = data.onerror = function () {\r\n");
      out.write("                        if (this.width != 1 || this.height != 1) {\r\n");
      out.write("                            support = false;\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                    data.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\r\n");
      out.write("                    return support;\r\n");
      out.write("                })(),\r\n");
      out.write("\r\n");
      out.write("                // 检测是否已经安装flash，检测flash的版本\r\n");
      out.write("                flashVersion = (function () {\r\n");
      out.write("                    var version;\r\n");
      out.write("\r\n");
      out.write("                    try {\r\n");
      out.write("                        version = navigator.plugins['Shockwave Flash'];\r\n");
      out.write("                        version = version.description;\r\n");
      out.write("                    } catch (ex) {\r\n");
      out.write("                        try {\r\n");
      out.write("                            version = new ActiveXObject('ShockwaveFlash.ShockwaveFlash')\r\n");
      out.write("                                .GetVariable('$version');\r\n");
      out.write("                        } catch (ex2) {\r\n");
      out.write("                            version = '0.0';\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                    version = version.match(/\\d+/g);\r\n");
      out.write("                    return parseFloat(version[0] + '.' + version[1], 10);\r\n");
      out.write("                })(),\r\n");
      out.write("\r\n");
      out.write("                supportTransition = (function () {\r\n");
      out.write("                    var s = document.createElement('p').style,\r\n");
      out.write("                        r = 'transition' in s ||\r\n");
      out.write("                            'WebkitTransition' in s ||\r\n");
      out.write("                            'MozTransition' in s ||\r\n");
      out.write("                            'msTransition' in s ||\r\n");
      out.write("                            'OTransition' in s;\r\n");
      out.write("                    s = null;\r\n");
      out.write("                    return r;\r\n");
      out.write("                })(),\r\n");
      out.write("\r\n");
      out.write("                // WebUploader实例\r\n");
      out.write("                uploader;\r\n");
      out.write("\r\n");
      out.write("            if (!WebUploader.Uploader.support('flash') && WebUploader.browser.ie) {\r\n");
      out.write("\r\n");
      out.write("                // flash 安装了但是版本过低。\r\n");
      out.write("                if (flashVersion) {\r\n");
      out.write("                    (function (container) {\r\n");
      out.write("                        window['expressinstallcallback'] = function (state) {\r\n");
      out.write("                            switch (state) {\r\n");
      out.write("                                case 'Download.Cancelled':\r\n");
      out.write("                                    alert('您取消了更新！')\r\n");
      out.write("                                    break;\r\n");
      out.write("\r\n");
      out.write("                                case 'Download.Failed':\r\n");
      out.write("                                    alert('安装失败')\r\n");
      out.write("                                    break;\r\n");
      out.write("\r\n");
      out.write("                                default:\r\n");
      out.write("                                    alert('安装已成功，请刷新！');\r\n");
      out.write("                                    break;\r\n");
      out.write("                            }\r\n");
      out.write("                            delete window['expressinstallcallback'];\r\n");
      out.write("                        };\r\n");
      out.write("\r\n");
      out.write("                        var swf = 'expressInstall.swf';\r\n");
      out.write("                        // insert flash object\r\n");
      out.write("                        var html = '<object type=\"application/' +\r\n");
      out.write("                            'x-shockwave-flash\" data=\"' + swf + '\" ';\r\n");
      out.write("\r\n");
      out.write("                        if (WebUploader.browser.ie) {\r\n");
      out.write("                            html += 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" ';\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        html += 'width=\"100%\" height=\"100%\" style=\"outline:0\">' +\r\n");
      out.write("                            '<param name=\"movie\" value=\"' + swf + '\" />' +\r\n");
      out.write("                            '<param name=\"wmode\" value=\"transparent\" />' +\r\n");
      out.write("                            '<param name=\"allowscriptaccess\" value=\"always\" />' +\r\n");
      out.write("                            '</object>';\r\n");
      out.write("\r\n");
      out.write("                        container.html(html);\r\n");
      out.write("\r\n");
      out.write("                    })($wrap);\r\n");
      out.write("\r\n");
      out.write("                    // 压根就没有安转。\r\n");
      out.write("                } else {\r\n");
      out.write("                    $wrap.html('<a href=\"http://www.adobe.com/go/getflashplayer\" target=\"_blank\" border=\"0\"><img alt=\"get flash player\" src=\"http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg\" /></a>');\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                return;\r\n");
      out.write("            } else if (!WebUploader.Uploader.support()) {\r\n");
      out.write("                alert('Web Uploader 不支持您的浏览器！');\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            // 实例化\r\n");
      out.write("            uploader = WebUploader.create({\r\n");
      out.write("                pick: {\r\n");
      out.write("                    id: '#filePicker-2',\r\n");
      out.write("                    label: '点击选择图片'\r\n");
      out.write("                },\r\n");
      out.write("                formData: {\r\n");
      out.write("                    uid: 123\r\n");
      out.write("                },\r\n");
      out.write("                dnd: '#dndArea',\r\n");
      out.write("                paste: '#uploader',\r\n");
      out.write("                swf: 'lib/webuploader/0.1.5/Uploader.swf',\r\n");
      out.write("                chunked: false,\r\n");
      out.write("                chunkSize: 512 * 1024,\r\n");
      out.write("                server: '/image/imageUpload',\r\n");
      out.write("                // runtimeOrder: 'flash',\r\n");
      out.write("\r\n");
      out.write("                accept: {\r\n");
      out.write("                    title: 'Images',\r\n");
      out.write("                    extensions: 'gif,jpg,jpeg,bmp,png',\r\n");
      out.write("                    //mimeTypes: 'image/*'\r\n");
      out.write("                },\r\n");
      out.write("\r\n");
      out.write("                // 禁掉全局的拖拽功能。这样不会出现图片拖进页面的时候，把图片打开。\r\n");
      out.write("                disableGlobalDnd: true,\r\n");
      out.write("                fileNumLimit: 5,\r\n");
      out.write("                fileSizeLimit: 25 * 1024 * 1024,    // 25 M\r\n");
      out.write("                fileSingleSizeLimit: 5 * 1024 * 1024    // 5 M\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // 拖拽时不接受 js, txt 文件。\r\n");
      out.write("            uploader.on('dndAccept', function (items) {\r\n");
      out.write("                var denied = false,\r\n");
      out.write("                    len = items.length,\r\n");
      out.write("                    i = 0,\r\n");
      out.write("                    // 修改js类型\r\n");
      out.write("                    unAllowed = 'text/plain;application/javascript ';\r\n");
      out.write("\r\n");
      out.write("                for (; i < len; i++) {\r\n");
      out.write("                    // 如果在列表里面\r\n");
      out.write("                    if (~unAllowed.indexOf(items[i].type)) {\r\n");
      out.write("                        denied = true;\r\n");
      out.write("                        break;\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                return !denied;\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            uploader.on('dialogOpen', function () {\r\n");
      out.write("                console.log('here');\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // uploader.on('filesQueued', function() {\r\n");
      out.write("            //     uploader.sort(function( a, b ) {\r\n");
      out.write("            //         if ( a.name < b.name )\r\n");
      out.write("            //           return -1;\r\n");
      out.write("            //         if ( a.name > b.name )\r\n");
      out.write("            //           return 1;\r\n");
      out.write("            //         return 0;\r\n");
      out.write("            //     });\r\n");
      out.write("            // });\r\n");
      out.write("\r\n");
      out.write("            // 添加“添加文件”的按钮，\r\n");
      out.write("            uploader.addButton({\r\n");
      out.write("                id: '#filePicker2',\r\n");
      out.write("                label: '继续添加'\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            uploader.on('ready', function () {\r\n");
      out.write("                window.uploader = uploader;\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            // 当有文件添加进来时执行，负责view的创建\r\n");
      out.write("            function addFile(file) {\r\n");
      out.write("                var $li = $('<li id=\"' + file.id + '\">' +\r\n");
      out.write("                    '<p class=\"title\">' + file.name + '</p>' +\r\n");
      out.write("                    '<p class=\"imgWrap\"></p>' +\r\n");
      out.write("                    '<p class=\"progress\"><span></span></p>' +\r\n");
      out.write("                    '</li>'),\r\n");
      out.write("\r\n");
      out.write("                    $btns = $('<div class=\"file-panel\">' +\r\n");
      out.write("                        '<span class=\"cancel\">删除</span>' +\r\n");
      out.write("                        '<span class=\"rotateRight\">向右旋转</span>' +\r\n");
      out.write("                        '<span class=\"rotateLeft\">向左旋转</span></div>').appendTo($li),\r\n");
      out.write("                    $prgress = $li.find('p.progress span'),\r\n");
      out.write("                    $wrap = $li.find('p.imgWrap'),\r\n");
      out.write("                    $info = $('<p class=\"error\"></p>'),\r\n");
      out.write("\r\n");
      out.write("                    showError = function (code) {\r\n");
      out.write("                        switch (code) {\r\n");
      out.write("                            case 'exceed_size':\r\n");
      out.write("                                text = '文件大小超出';\r\n");
      out.write("                                break;\r\n");
      out.write("\r\n");
      out.write("                            case 'interrupt':\r\n");
      out.write("                                text = '上传暂停';\r\n");
      out.write("                                break;\r\n");
      out.write("\r\n");
      out.write("                            default:\r\n");
      out.write("                                text = '上传失败，请重试';\r\n");
      out.write("                                break;\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        $info.text(text).appendTo($li);\r\n");
      out.write("                    };\r\n");
      out.write("\r\n");
      out.write("                if (file.getStatus() === 'invalid') {\r\n");
      out.write("                    showError(file.statusText);\r\n");
      out.write("                } else {\r\n");
      out.write("                    // @todo lazyload\r\n");
      out.write("                    $wrap.text('预览中');\r\n");
      out.write("                    uploader.makeThumb(file, function (error, src) {\r\n");
      out.write("                        var img;\r\n");
      out.write("\r\n");
      out.write("                        if (error) {\r\n");
      out.write("                            $wrap.text('不能预览');\r\n");
      out.write("                            return;\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        if (isSupportBase64) {\r\n");
      out.write("                            img = $('<img src=\"' + src + '\">');\r\n");
      out.write("                            $wrap.empty().append(img);\r\n");
      out.write("                        } else {\r\n");
      out.write("                            $.ajax('lib/webuploader/0.1.5/server/preview.php', {\r\n");
      out.write("                                method: 'POST',\r\n");
      out.write("                                data: src,\r\n");
      out.write("                                dataType: 'json'\r\n");
      out.write("                            }).done(function (response) {\r\n");
      out.write("                                if (response.result) {\r\n");
      out.write("                                    img = $('<img src=\"' + response.result + '\">');\r\n");
      out.write("                                    $wrap.empty().append(img);\r\n");
      out.write("                                } else {\r\n");
      out.write("                                    $wrap.text(\"预览出错\");\r\n");
      out.write("                                }\r\n");
      out.write("                            });\r\n");
      out.write("                        }\r\n");
      out.write("                    }, thumbnailWidth, thumbnailHeight);\r\n");
      out.write("\r\n");
      out.write("                    percentages[file.id] = [file.size, 0];\r\n");
      out.write("                    file.rotation = 0;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                file.on('statuschange', function (cur, prev) {\r\n");
      out.write("                    if (prev === 'progress') {\r\n");
      out.write("                        $prgress.hide().width(0);\r\n");
      out.write("                    } else if (prev === 'queued') {\r\n");
      out.write("                        $li.off('mouseenter mouseleave');\r\n");
      out.write("                        $btns.remove();\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    // 成功\r\n");
      out.write("                    if (cur === 'error' || cur === 'invalid') {\r\n");
      out.write("                        console.log(file.statusText);\r\n");
      out.write("                        showError(file.statusText);\r\n");
      out.write("                        percentages[file.id][1] = 1;\r\n");
      out.write("                    } else if (cur === 'interrupt') {\r\n");
      out.write("                        showError('interrupt');\r\n");
      out.write("                    } else if (cur === 'queued') {\r\n");
      out.write("                        percentages[file.id][1] = 0;\r\n");
      out.write("                    } else if (cur === 'progress') {\r\n");
      out.write("                        $info.remove();\r\n");
      out.write("                        $prgress.css('display', 'block');\r\n");
      out.write("                    } else if (cur === 'complete') {\r\n");
      out.write("                        $li.append('<span class=\"success\"></span>');\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    $li.removeClass('state-' + prev).addClass('state-' + cur);\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                $li.on('mouseenter', function () {\r\n");
      out.write("                    $btns.stop().animate({height: 30});\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                $li.on('mouseleave', function () {\r\n");
      out.write("                    $btns.stop().animate({height: 0});\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                $btns.on('click', 'span', function () {\r\n");
      out.write("                    var index = $(this).index(),\r\n");
      out.write("                        deg;\r\n");
      out.write("\r\n");
      out.write("                    switch (index) {\r\n");
      out.write("                        case 0:\r\n");
      out.write("                            uploader.removeFile(file);\r\n");
      out.write("                            return;\r\n");
      out.write("\r\n");
      out.write("                        case 1:\r\n");
      out.write("                            file.rotation += 90;\r\n");
      out.write("                            break;\r\n");
      out.write("\r\n");
      out.write("                        case 2:\r\n");
      out.write("                            file.rotation -= 90;\r\n");
      out.write("                            break;\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    if (supportTransition) {\r\n");
      out.write("                        deg = 'rotate(' + file.rotation + 'deg)';\r\n");
      out.write("                        $wrap.css({\r\n");
      out.write("                            '-webkit-transform': deg,\r\n");
      out.write("                            '-mos-transform': deg,\r\n");
      out.write("                            '-o-transform': deg,\r\n");
      out.write("                            'transform': deg\r\n");
      out.write("                        });\r\n");
      out.write("                    } else {\r\n");
      out.write("                        $wrap.css('filter', 'progid:DXImageTransform.Microsoft.BasicImage(rotation=' + (~~((file.rotation / 90) % 4 + 4) % 4) + ')');\r\n");
      out.write("                        // use jquery animate to rotation\r\n");
      out.write("                        // $({\r\n");
      out.write("                        //     rotation: rotation\r\n");
      out.write("                        // }).animate({\r\n");
      out.write("                        //     rotation: file.rotation\r\n");
      out.write("                        // }, {\r\n");
      out.write("                        //     easing: 'linear',\r\n");
      out.write("                        //     step: function( now ) {\r\n");
      out.write("                        //         now = now * Math.PI / 180;\r\n");
      out.write("\r\n");
      out.write("                        //         var cos = Math.cos( now ),\r\n");
      out.write("                        //             sin = Math.sin( now );\r\n");
      out.write("\r\n");
      out.write("                        //         $wrap.css( 'filter', \"progid:DXImageTransform.Microsoft.Matrix(M11=\" + cos + \",M12=\" + (-sin) + \",M21=\" + sin + \",M22=\" + cos + \",SizingMethod='auto expand')\");\r\n");
      out.write("                        //     }\r\n");
      out.write("                        // });\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                $li.appendTo($queue);\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            // 负责view的销毁\r\n");
      out.write("            function removeFile(file) {\r\n");
      out.write("                var $li = $('#' + file.id);\r\n");
      out.write("\r\n");
      out.write("                delete percentages[file.id];\r\n");
      out.write("                updateTotalProgress();\r\n");
      out.write("                $li.off().find('.file-panel').off().end().remove();\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            function updateTotalProgress() {\r\n");
      out.write("                var loaded = 0,\r\n");
      out.write("                    total = 0,\r\n");
      out.write("                    spans = $progress.children(),\r\n");
      out.write("                    percent;\r\n");
      out.write("\r\n");
      out.write("                $.each(percentages, function (k, v) {\r\n");
      out.write("                    total += v[0];\r\n");
      out.write("                    loaded += v[0] * v[1];\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                percent = total ? loaded / total : 0;\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("                spans.eq(0).text(Math.round(percent * 100) + '%');\r\n");
      out.write("                spans.eq(1).css('width', Math.round(percent * 100) + '%');\r\n");
      out.write("                updateStatus();\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            function updateStatus() {\r\n");
      out.write("                var text = '', stats;\r\n");
      out.write("\r\n");
      out.write("                if (state === 'ready') {\r\n");
      out.write("                    text = '选中' + fileCount + '张图片，共' +\r\n");
      out.write("                        WebUploader.formatSize(fileSize) + '。';\r\n");
      out.write("                } else if (state === 'confirm') {\r\n");
      out.write("                    stats = uploader.getStats();\r\n");
      out.write("                    if (stats.uploadFailNum) {\r\n");
      out.write("                        text = '已成功上传' + stats.successNum + '张照片，' +\r\n");
      out.write("                            stats.uploadFailNum + '张照片上传失败，<a class=\"retry\" href=\"#\">重新上传</a>失败图片或<a class=\"ignore\" href=\"#\">忽略</a>'\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                } else {\r\n");
      out.write("                    stats = uploader.getStats();\r\n");
      out.write("                    text = '共' + fileCount + '张（' +\r\n");
      out.write("                        WebUploader.formatSize(fileSize) +\r\n");
      out.write("                        '），已上传' + stats.successNum + '张';\r\n");
      out.write("\r\n");
      out.write("                    if (stats.uploadFailNum) {\r\n");
      out.write("                        text += '，失败' + stats.uploadFailNum + '张';\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                $info.html(text);\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            function setState(val) {\r\n");
      out.write("                var file, stats;\r\n");
      out.write("\r\n");
      out.write("                if (val === state) {\r\n");
      out.write("                    return;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                $upload.removeClass('state-' + state);\r\n");
      out.write("                $upload.addClass('state-' + val);\r\n");
      out.write("                state = val;\r\n");
      out.write("\r\n");
      out.write("                switch (state) {\r\n");
      out.write("                    case 'pedding':\r\n");
      out.write("                        $placeHolder.removeClass('element-invisible');\r\n");
      out.write("                        $queue.hide();\r\n");
      out.write("                        $statusBar.addClass('element-invisible');\r\n");
      out.write("                        uploader.refresh();\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                    case 'ready':\r\n");
      out.write("                        $placeHolder.addClass('element-invisible');\r\n");
      out.write("                        $('#filePicker2').removeClass('element-invisible');\r\n");
      out.write("                        $queue.show();\r\n");
      out.write("                        $statusBar.removeClass('element-invisible');\r\n");
      out.write("                        uploader.refresh();\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                    case 'uploading':\r\n");
      out.write("                        $('#filePicker2').addClass('element-invisible');\r\n");
      out.write("                        $progress.show();\r\n");
      out.write("                        $upload.text('暂停上传');\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                    case 'paused':\r\n");
      out.write("                        $progress.show();\r\n");
      out.write("                        $upload.text('继续上传');\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                    case 'confirm':\r\n");
      out.write("                        $progress.hide();\r\n");
      out.write("                        $('#filePicker2').removeClass('element-invisible');\r\n");
      out.write("                        $upload.text('开始上传');\r\n");
      out.write("\r\n");
      out.write("                        stats = uploader.getStats();\r\n");
      out.write("                        if (stats.successNum && !stats.uploadFailNum) {\r\n");
      out.write("                            setState('finish');\r\n");
      out.write("                            return;\r\n");
      out.write("                        }\r\n");
      out.write("                        break;\r\n");
      out.write("                    case 'finish':\r\n");
      out.write("                        stats = uploader.getStats();\r\n");
      out.write("                        if (stats.successNum) {\r\n");
      out.write("                            //alert('上传成功');\r\n");
      out.write("                        } else {\r\n");
      out.write("                            // 没有成功的图片，重设\r\n");
      out.write("                            state = 'done';\r\n");
      out.write("                            location.reload();\r\n");
      out.write("                        }\r\n");
      out.write("                        break;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                updateStatus();\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            uploader.onUploadProgress = function (file, percentage) {\r\n");
      out.write("                var $li = $('#' + file.id),\r\n");
      out.write("                    $percent = $li.find('.progress span');\r\n");
      out.write("\r\n");
      out.write("                $percent.css('width', percentage * 100 + '%');\r\n");
      out.write("                percentages[file.id][1] = percentage;\r\n");
      out.write("                updateTotalProgress();\r\n");
      out.write("            };\r\n");
      out.write("\r\n");
      out.write("            uploader.onFileQueued = function (file) {\r\n");
      out.write("                fileCount++;\r\n");
      out.write("                fileSize += file.size;\r\n");
      out.write("\r\n");
      out.write("                if (fileCount === 1) {\r\n");
      out.write("                    $placeHolder.addClass('element-invisible');\r\n");
      out.write("                    $statusBar.show();\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                addFile(file);\r\n");
      out.write("                setState('ready');\r\n");
      out.write("                updateTotalProgress();\r\n");
      out.write("            };\r\n");
      out.write("\r\n");
      out.write("            uploader.onFileDequeued = function (file) {\r\n");
      out.write("                fileCount--;\r\n");
      out.write("                fileSize -= file.size;\r\n");
      out.write("\r\n");
      out.write("                if (!fileCount) {\r\n");
      out.write("                    setState('pedding');\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                removeFile(file);\r\n");
      out.write("                updateTotalProgress();\r\n");
      out.write("\r\n");
      out.write("            };\r\n");
      out.write("            // 文件上传成功\r\n");
      out.write("            uploader.on( 'uploadSuccess', function( file,data ) {\r\n");
      out.write("\r\n");
      out.write("                if(data.success==true){\r\n");
      out.write("                    if(images==null){\r\n");
      out.write("                        images=data.result;\r\n");
      out.write("                    }else{\r\n");
      out.write("                        images+=\",\"+data.result;\r\n");
      out.write("                    }\r\n");
      out.write("                    $(\"#image\").val(images);\r\n");
      out.write("                }else{\r\n");
      out.write("                    alert(\"上传失败:\"+data.message)\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("            uploader.on('all', function (type) {\r\n");
      out.write("                var stats;\r\n");
      out.write("                switch (type) {\r\n");
      out.write("                    case 'uploadFinished':\r\n");
      out.write("                        setState('confirm');\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                    case 'startUpload':\r\n");
      out.write("                        setState('uploading');\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                    case 'stopUpload':\r\n");
      out.write("                        setState('paused');\r\n");
      out.write("                        break;\r\n");
      out.write("\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            uploader.onError = function (code) {\r\n");
      out.write("                if(code==\"Q_TYPE_DENIED\"){\r\n");
      out.write("                    alert(\"文件类型不支持，仅支持gif,jpg,jpeg,bmp,png格式图片\");\r\n");
      out.write("                }else if(code==\"F_DUPLICATE\"){\r\n");
      out.write("                    alert(\"文件已选中，请勿重复上传\");\r\n");
      out.write("                }else if(code=\"F_EXCEED_SIZE\"){\r\n");
      out.write("                    alert(\"文件大小超出限制，单张图片不得超过5MB\");\r\n");
      out.write("                } else{\r\n");
      out.write("                    alert('Error: ' + code);\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("            };\r\n");
      out.write("\r\n");
      out.write("            $upload.on('click', function () {\r\n");
      out.write("                if ($(this).hasClass('disabled')) {\r\n");
      out.write("                    return false;\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                if (state === 'ready') {\r\n");
      out.write("                    uploader.upload();\r\n");
      out.write("                } else if (state === 'paused') {\r\n");
      out.write("                    uploader.upload();\r\n");
      out.write("                } else if (state === 'uploading') {\r\n");
      out.write("                    uploader.stop();\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            $info.on('click', '.retry', function () {\r\n");
      out.write("                uploader.retry();\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            $info.on('click', '.ignore', function () {\r\n");
      out.write("                alert('已忽略');\r\n");
      out.write("            });\r\n");
      out.write("\r\n");
      out.write("            $upload.addClass('state-' + state);\r\n");
      out.write("            updateTotalProgress();\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("    })(jQuery);\r\n");
      out.write("</script>\r\n");
      out.write("</body>\r\n");
      out.write("</html>\r\n");
      out.write('\r');
      out.write('\n');
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
